<!-- frontend/optimization.html (UPDATED) -->
<div id="dashboardContainer" class="nhs-dashboard">
  <div class="dashboard-tabs">
    <button class="dashboard-tab active" data-target="softParameters">Soft Parameters</button>
    <button class="dashboard-tab" data-target="fixedParameters">Fixed Parameters</button>
    <button class="dashboard-tab" data-target="optimization1">Optimization 1</button>
    <button class="dashboard-tab" data-target="optimization2">Optimization 2</button>
    <button class="dashboard-tab" data-target="optimization3">Optimization 3</button>
  </div>

  <!-- 1) SOFT PARAMETERS (Optimization 1 - Scoring) -->
  <div id="softParameters" class="dashboard-content active">
    <div class="top-pane">
      <h2>Soft Parameters - Scoring Weights</h2>
      <p class="section-description">Define weighted parameters for ranking repairs. Parameters search across all fields in the location Excel file.</p>
      <div id="paramContainer"></div>
      <div class="actions">
        <button id="addParamBtn" class="btn">+ Add Parameter</button>
        <button id="saveParamsBtn" class="btn btn-primary">üíæ Save Changes</button>
      </div>
    </div>

    <hr class="separator"/>

    <div class="bottom-pane">
      <div id="percentageSection" style="margin-top:1em;">
        <h3>Percentage Summary</h3>
        <p>Total: <span id="percentageTotal">0</span>%</p>
      </div>
    </div>
  </div>

  <!-- 2) FIXED PARAMETERS (Optimization 3 - Yearly Constraints) -->
  <div id="fixedParameters" class="dashboard-content">
    <div class="top-pane">
      <h2>Fixed Parameters - Constraint Filtering</h2>
      <p class="section-description">Define constraints to filter repairs. Repairs not meeting all constraints will be filtered out. Constraints search across all fields in the location Excel file.</p>
      <div id="fixedParamContainer"></div>
      <div class="actions">
        <button id="addFixedParamBtn" class="btn">+ Add Fixed Parameter</button>
        <button id="saveFixedParamsBtn" class="btn btn-primary">üíæ Save Changes</button>
      </div>
    </div>
  </div>

  <!-- 3) OPTIMIZATION 1 - Scoring -->
  <div id="optimization1" class="dashboard-content">
    <div class="opt-container">
      <h2>Optimization 1 - Repair Scoring</h2>
      <p class="section-description">Score and rank all repairs using soft parameter weights.</p>
      <button id="runOpt1Btn" class="btn btn-primary">Run Optimization 1</button>
      
      <div id="opt1Results" style="margin-top: 2em;"></div>
    </div>
  </div>

  <!-- 4) OPTIMIZATION 2 - Trip Grouping -->
  <div id="optimization2" class="dashboard-content">
    <div class="opt-container">
      <h2>Optimization 2 - Trip Grouping</h2>
      <p class="section-description">
        Group scored repairs by trip location and access type.
        <br/>
        <strong>‚ö†Ô∏è Note:</strong> You must run Optimization 1 first.
      </p>
      <button id="runOpt2Btn" class="btn btn-primary">Run Optimization 2</button>
      
      <div id="opt2Results" style="margin-top: 2em;"></div>
    </div>
  </div>

  <!-- 5) OPTIMIZATION 3 - Yearly Assignment -->
  <div id="optimization3" class="dashboard-content">
    <div class="opt-container">
      <h2>Optimization 3 - Yearly Assignment</h2>
      <p class="section-description">
        Assign trips to years based on fixed parameter constraints.
        <br/>
        <strong>‚ö†Ô∏è Note:</strong> You must run Optimizations 1 and 2 first.
      </p>
      <button id="runOpt3Btn" class="btn btn-primary">Run Optimization 3</button>
      
      <div id="opt3Results" style="margin-top: 2em;"></div>
    </div>
  </div>

  <!-- Add Soft Parameter Modal -->
  <div id="addParamModal" class="modal" style="display:none;">
    <div class="modal-content" style="width:400px; max-width:90%;">
      <span class="close-modal" id="closeAddParamModal">&times;</span>
      <h2 class="modal-header">Add Soft Parameter</h2>

      <div style="margin-top:1em;">
        <label>Parameter Name (Field Name)</label><br/>
        <input type="text" id="paramNameInput" placeholder="Start typing to see suggestions..." style="width:100%; padding:0.5em;"/>
      </div>

      <div style="margin-top:1em;">
        <label>Condition Type</label><br/>
        <select id="paramConditionSelect" style="width:100%; padding:0.5em;">
          <option value="IF">IF</option>
        </select>
      </div>

      <div style="margin-top:1em;">
        <label>Max Weight (1‚ÄìY)</label><br/>
        <input type="number" id="paramMaxWeight" min="1" value="3" style="width:100%; padding:0.5em;"/>
      </div>

      <div id="optionsContainer" style="margin-top:1em;">
        <h3>Options ‚Üí Weight</h3>
        <button type="button" id="addOptionBtn" class="btn" style="margin-bottom:0.5em;">+ Add Option</button>
        <div id="optionsList"></div>
      </div>

      <div style="margin-top:1.5em; text-align:right;">
        <button id="saveParamBtn" class="btn btn-primary">Save Parameter</button>
        <button id="cancelParamBtn" class="btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Add Fixed Parameter Modal -->
  <div id="addFixedParamModal" class="modal" style="display:none;">
    <div class="modal-content" style="width:500px; max-width:90%;">
      <span class="close-modal" id="closeAddFixedParamModal">&times;</span>
      <h2 class="modal-header">Add Fixed Parameter</h2>

      <div style="margin-top:1em;">
        <label>Fixed Parameter Name</label><br/>
        <input type="text" id="fixedParamNameInput" placeholder="Start typing to see suggestions..." style="width:100%; padding:0.5em;"/>
      </div>

      <div id="matchUsingContainer" style="margin-top:1em; display:none;">
        <label>Match Using</label><br/>
        <select id="fixedParamMatchUsing" style="width:100%; padding:0.5em;">
          <option value="parameter_name">Fixed Parameter Name</option>
          <option value="field_name">Field Name</option>
        </select>
      </div>

      <div style="margin-top:1em;">
        <label>Constraint Type</label><br/>
        <select id="fixedParamTypeSelect" style="width:100%; padding:0.5em;">
          <option value="geographical">Geographical</option>
          <option value="temporal">Temporal</option>
          <option value="monetary">Monetary</option>
          <option value="designation">Designation</option>
        </select>
      </div>

      <!-- Geographical Fields -->
      <div id="geographicalFields" class="constraint-fields" style="display:none; margin-top:1em;">
        <label>Allowed Values</label>
        <div id="geoValuesList" style="margin-top:0.5em;"></div>
        <button type="button" id="addGeoValueBtn" class="btn" style="margin-top:0.5em;">+ Add Value</button>
      </div>

      <!-- Temporal Fields -->
      <div id="temporalFields" class="constraint-fields" style="display:none; margin-top:1em;">
        <div style="margin-bottom:0.5em;">
          <label style="display:flex; align-items:center; gap:0.5em; cursor:pointer;">
            <input type="checkbox" id="temporalCumulative" style="cursor:pointer;"/>
            <span>Cumulative (sum all repairs for the year)</span>
          </label>
          <p style="font-size:0.85em; color:#666; margin:0.3em 0 0 1.5em;">
            When checked, adds up all repair values for the year. When unchecked, checks each repair individually.
          </p>
        </div>
        <div style="margin-bottom:0.5em;">
          <label>Scope</label><br/>
          <select id="temporalScope" style="width:100%; padding:0.5em;">
            <option value="per_day">Per Day</option>
            <option value="per_week">Per Week</option>
            <option value="per_month">Per Month</option>
            <option value="per_year">Per Year</option>
          </select>
        </div>
        <div style="margin-bottom:0.5em;">
          <label>Value</label><br/>
          <input type="number" id="temporalValue" placeholder="Enter value" style="width:100%; padding:0.5em;"/>
        </div>
        <div>
          <label>Unit</label><br/>
          <select id="temporalUnit" style="width:100%; padding:0.5em;">
            <option value="hours">Hours</option>
            <option value="days">Days</option>
            <option value="weeks">Weeks</option>
            <option value="months">Months</option>
            <option value="years">Years</option>
          </select>
        </div>
      </div>

      <!-- Monetary Fields -->
      <div id="monetaryFields" class="constraint-fields" style="display:none; margin-top:1em;">
        <div style="margin-bottom:0.5em;">
          <label style="display:flex; align-items:center; gap:0.5em; cursor:pointer;">
            <input type="checkbox" id="monetaryCumulative" style="cursor:pointer;"/>
            <span>Cumulative Budget (sum all repairs for the year)</span>
          </label>
          <p style="font-size:0.85em; color:#666; margin:0.3em 0 0 1.5em;">
            When checked, treats the value as total yearly budget. When unchecked, checks each repair individually.
          </p>
        </div>
        <div style="margin-bottom:0.5em;">
          <label>Field Name</label><br/>
          <input type="text" id="monetaryFieldName" placeholder="Start typing to see suggestions..." style="width:100%; padding:0.5em;"/>
        </div>
        <div style="margin-bottom:0.5em;">
          <label>Conditional</label><br/>
          <select id="monetaryConditional" style="width:100%; padding:0.5em;">
            <option value="<">Less than (<)</option>
            <option value="<=">Less than or equal (<=)</option>
            <option value=">">Greater than (>)</option>
            <option value=">=">Greater than or equal (>=)</option>
            <option value="=">Equal (=)</option>
            <option value="!=">Not equal (!=)</option>
          </select>
        </div>
        <div style="margin-bottom:0.5em;">
          <label>Value</label><br/>
          <input type="number" id="monetaryValue" placeholder="Enter numeric value" style="width:100%; padding:0.5em;"/>
        </div>
        <div>
          <label>Unit</label><br/>
          <input type="text" id="monetaryUnit" placeholder="$" style="width:100%; padding:0.5em;"/>
        </div>
      </div>

      <!-- Designation Fields -->
      <div id="designationFields" class="constraint-fields" style="display:none; margin-top:1em;">
        <div style="margin-bottom:0.5em;">
          <label>Condition</label><br/>
          <select id="designationCondition" style="width:100%; padding:0.5em;">
            <option value="None">None (filter out if present)</option>
            <option value="Only">Only (keep only if present)</option>
          </select>
        </div>
        <div>
          <label>Field Name</label><br/>
          <input type="text" id="designationFieldName" placeholder="Start typing to see suggestions..." style="width:100%; padding:0.5em;"/>
        </div>
      </div>

      <!-- SPLIT Condition (Monetary only) -->
      <div id="splitConditionContainer" style="display:none; margin-top:1.2em; padding-top:1em; border-top:2px solid #ddd;">
        <div style="display:flex; align-items:center; gap:0.5em; margin-bottom:0.5em;">
          <input type="checkbox" id="enableSplitCondition" style="cursor:pointer;"/>
          <label for="enableSplitCondition" style="cursor:pointer; font-weight:bold;">Add SPLIT Condition (Optional)</label>
        </div>
        <p style="font-size:0.9em; color:#666; margin:0 0 1em 0;">
          When enabled, the monetary <em>field value</em> for each repair will be multiplied by the percentage
          associated with the selected <strong>Source</strong> parsed from the repair‚Äôs category column
          (<code>O&amp;M</code>, <code>Capital</code>, or <code>Decommission</code>) before comparison to the limit.
        </p>
       <div id="splitFields" style="display:none; padding:0.8em; background:#f8f9fa; border-radius:4px;">
          <div style="margin-bottom:0.5em;">
            <label>Source</label><br/>
            <input
              type="text"
              id="splitSourceInput"
              placeholder="Type or pick a Source (e.g., F, P, P(OTH), P(BCH), etc."
              style="width:100%; padding:0.5em;"
            />
            <div style="font-size:0.85em; color:#666; margin-top:0.4em;">
              Suggestions are collected from the <strong>O&amp;M</strong>, <strong>Capital</strong>, and
              <strong>Decommission</strong> columns in your repairs sheet (e.g., split strings like
              <code>50%F-50%P</code> or <code>100%P(OTH)</code>).
            </div>
          </div>
        </div>
      </div>

      <!-- IF Condition (Optional) -->
      <div style="margin-top:1.5em; padding-top:1em; border-top:2px solid #ddd;">
        <div style="display:flex; align-items:center; gap:0.5em; margin-bottom:0.5em;">
          <input type="checkbox" id="enableIfCondition" style="cursor:pointer;"/>
          <label for="enableIfCondition" style="cursor:pointer; font-weight:bold;">Add IF Condition (Optional)</label>
        </div>
        <p style="font-size:0.9em; color:#666; margin:0 0 1em 0;">
          Only apply this constraint when a condition is met (e.g., Cost &lt; 30,000 IF Type = "O&M")
        </p>
        
        <div id="ifConditionFields" style="display:none; padding:1em; background:#f8f9fa; border-radius:4px;">
          <div style="margin-bottom:0.5em;">
            <label>Field Name</label><br/>
            <input type="text" id="ifFieldName" placeholder="Start typing to see suggestions..." style="width:100%; padding:0.5em;"/>
          </div>
          
          <div style="margin-bottom:0.5em;">
            <label>Operator</label><br/>
            <select id="ifOperator" style="width:100%; padding:0.5em;">
              <option value="=">=  (equals)</option>
              <option value="!=">!= (not equals)</option>
              <option value="contains">contains</option>
            </select>
          </div>
          
          <div>
            <label>Value</label><br/>
            <input type="text" id="ifValue" placeholder="e.g., O&M, Capital, Active" style="width:100%; padding:0.5em;"/>
          </div>
        </div>
      </div>

      <div style="margin-top:1.5em; text-align:right;">
        <button id="saveFixedParamBtn" class="btn btn-primary">Save Fixed Parameter</button>
        <button id="cancelFixedParamBtn" class="btn">Cancel</button>
      </div>
    </div>
  </div>
  
  <!-- Add Year Modal -->
  <div id="addYearModal" class="modal" style="display:none;">
    <div class="modal-content" style="width:300px; max-width:90%;">
      <span class="close-modal" id="closeAddYearModal">&times;</span>
      <h2 class="modal-header">Add Year</h2>
      
      <div style="margin-top:1em;">
        <label>Enter Year</label><br/>
        <input type="number" id="yearInput" placeholder="e.g., 2025" min="2020" max="2100" 
               style="width:100%; padding:0.5em;"/>
      </div>
      
      <div style="margin-top:1.5em; text-align:right;">
        <button id="confirmAddYearBtn" class="btn btn-primary">Add Year</button>
        <button id="cancelAddYearBtn" class="btn">Cancel</button>
      </div>
    </div>
  </div>

</div>